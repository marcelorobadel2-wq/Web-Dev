import React, { useState, useEffect } from 'react';
import { Hero } from './sections/Hero';
import { Navbar } from './components/Navbar';
import { VSL } from './sections/VSL';
import { Problem } from './sections/Problem';
import { Mechanism } from './sections/Mechanism';
import { Testimonials } from './sections/Testimonials';
import { LiveRoom } from './sections/LiveRoom';
import { Offer } from './sections/Offer';
import { FAQ } from './sections/FAQ';
import { Footer } from './sections/Footer';
import { AdminDashboard } from './sections/AdminDashboard'; // Importando o Dashboard
import { DNANemesis } from './components/DNANemesis';
import { AIHelperBot } from './components/AIHelperBot';
import { GlobalNotes } from './components/GlobalNotes';
import { motion, useScroll, useSpring } from 'framer-motion';
import { Maximize, Minimize } from 'lucide-react';
import { CheckoutProvider } from './modules/checkout/context/CheckoutContext';
import { CheckoutDemo } from './modules/checkout/components/CheckoutDemo';

const App: React.FC = () => {
  const { scrollYProgress } = useScroll();
  const scaleX = useSpring(scrollYProgress, {
    stiffness: 100,
    damping: 30,
    restDelta: 0.001
  });

  const [isFullscreen, setIsFullscreen] = useState(false);
  const [isAdminOpen, setIsAdminOpen] = useState(false); // Estado para controlar a visão do Admin

  const toggleFullscreen = () => {
    if (!document.fullscreenElement) {
      document.documentElement.requestFullscreen().catch((e) => {
        console.error(`Error attempting to enable fullscreen: ${e.message} (${e.name})`);
      });
    } else {
      if (document.exitFullscreen) {
        document.exitFullscreen();
      }
    }
  };

  useEffect(() => {
    const handleFSChange = () => {
      setIsFullscreen(!!document.fullscreenElement);
    };
    document.addEventListener('fullscreenchange', handleFSChange);
    return () => document.removeEventListener('fullscreenchange', handleFSChange);
  }, []);

  // Renderização Condicional: Se Admin estiver aberto, mostra SÓ o Dashboard
  if (isAdminOpen) {
    return <AdminDashboard onExit={() => setIsAdminOpen(false)} />;
  }

  return (
    <CheckoutProvider>
      <main className="bg-slate-950 min-h-screen text-slate-200 antialiased overflow-x-hidden selection:bg-brand-500 selection:text-white relative">
        <Navbar />

        <div className="fixed top-24 right-6 z-40 hidden md:block">
          <button
            onClick={toggleFullscreen}
            className="bg-slate-900/50 backdrop-blur-md border border-slate-700 text-slate-300 hover:text-white hover:bg-brand-600 hover:border-brand-500 p-2 rounded-full shadow-lg transition-all duration-300 group"
            title={isFullscreen ? "Sair da Tela Cheia" : "Tela Cheia"}
          >
            {isFullscreen ? (
              <Minimize className="w-5 h-5" />
            ) : (
              <Maximize className="w-5 h-5" />
            )}
          </button>
        </div>

        {/* Ferramentas de Desenvolvimento e Gestão */}
        <DNANemesis />
        <GlobalNotes forcedContext="GustaPilates" />
        
        {/* AI Simulated Helper Bot */}
        <AIHelperBot />

        <motion.div
          className="fixed top-0 left-0 right-0 h-1 bg-gradient-to-r from-brand-500 to-brand-accent origin-left z-50"
          style={{ scaleX }}
        />

        <Hero />
        <VSL />
        <Problem />
        <Mechanism />
        <Testimonials />
        <LiveRoom />
        <Offer />
        
        {/* CHECKOUT MODULE DEMO SECTION */}
        <section id="checkout-module" className="py-20 bg-slate-900/30 border-y border-slate-800">
            <div className="container mx-auto text-center mb-10">
                <h3 className="text-xl font-mono text-brand-500 mb-4">--- CHECKOUT SEGURO ---</h3>
            </div>
            <CheckoutDemo />
        </section>

        <FAQ />
        
        {/* Passamos a função de abrir o Admin para o Footer */}
        <Footer onAdminClick={() => setIsAdminOpen(true)} />

        <motion.div 
          initial={{ opacity: 0, y: 100 }}
          whileInView={{ opacity: 1, y: 0 }}
          viewport={{ once: false, amount: 0 }}
          className="fixed bottom-0 left-0 right-0 p-4 bg-slate-900/80 backdrop-blur-lg border-t border-slate-800 md:hidden z-40"
        >
          <button 
            onClick={() => document.getElementById('offer')?.scrollIntoView({ behavior: 'smooth' })}
            className="w-full bg-brand-600 text-white font-bold py-4 rounded-full shadow-lg"
          >
            Secar Agora (R$ 497)
          </button>
        </motion.div>
      </main>
    </CheckoutProvider>
  );
};

export default App;